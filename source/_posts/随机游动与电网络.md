---
title: "随机游动与电网络"
date: 2019-10-06
categories: [随机游动]
url: "random-walk-and-electric-network"
---

\newcommand{\ind}[1]{\mathbb{1}_{\{ #1 \}}}
\newcommand{\xarr}[1]{\xrightarrow{\quad #1 \quad}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Reff}{\mathcal{R}_{\rm eff}(a\to Z)}

# 图上的线性代数

一个**网络** $\mathcal{N}=(G, c)$ 由一个有限图 $G=(V,E)$ 和一个权值函数 $c:E\to\mathbb{R}_{\geq0}$ 组成。这里 $G$ 是连通的无向图，其每条边 $e\in E$ 有一个权值 $c(e)\in[0, +\infty)$，叫做 $e$ 的**电导**，其倒数 $r(e)=1/c(e)$ 叫做 $e$ 的**电阻**。

设 $x,y\in V$ 是两个顶点，我们用 $x\sim y$ 表示 $x,y$ 是相邻的。当 $e=(x,y)$ 时，我们称 $e^-=x$ 为 $e$ 的**尾部**，$e^+=y$ 为 $e$ 的**头部**。记 $-e=(y,x)$ 为 $e$ 的**反向边**。在反向边 $-e$ 中 $x$ 变为头部，$y$ 变为尾部。

**我们约定 $E$ 总是同时包含一条边 $e=(x,y)$ 和它的反向边 $-e=(y,x)$**。此外，我们用记号 $E_{1/2}$ 表示对每个 $e$，在 $e$ 和 $-e$ 中任选一个组成的集合。$E_{1/2}$ 的一个选取方式对应 $G$ 的一个定向，不过我们不需要明确写出这个选取方式。

对 $e=(x,y)\in E$，我们也记 $c(x,y)=c(e)$。**我们要求电导函数 $c(x,y)$ 关于 $x,y$ 是对称的：$c(x,y)=c(y,x)$**。即在书写 $c(e)$ 的时候我们不用关心 $e$ 的定向。设 $x\in V$ 是一个顶点，记 $c(x)=\sum_{y\sim x}c(x,y)$ 是与 $x$ 相邻的所有边的电导之和。

所有 $V$ 上的实值函数 $f:V\to\mathbb{R}$ 构成一个内积空间 $\ell^2(V)$：
$$(f,\, g)_V = \sum_{x\in V}c(x)f(x)g(x).$$

所有 $E$ 上的**反对称**实值函数 $\theta: E\to\mathbb{R}$ 也构成一个内积空间 $\ell^2_{-}(E)$：
$$(\theta,\,\theta')_E = \frac{1}{2}\sum_{e\in E}r(e)\theta(e)\theta'(e)=\sum_{e\in E_{1/2}}r(e)\theta(e)\theta'(e).$$
这里 $\theta$ 是反对称函数的意思是，对任何 $e=\{x,y\}$ 有 $\theta(x, y)=-\theta(y,x)$。注意上式右边的求和与边的定向是无关的，因为如果把 $e$ 换成 $-e$ 的话，$\theta(e),\theta'(e)$ 同时变号，它们的乘积还是不变的。即内积 $(\cdot\,,\cdot)_E$ 的定义与 $E_{1/2}$ 的选取方式无关。

到目前为止，我们的设定基本上与 [@MR3616205] 一致，但是接下来的叙述会有一定的差别。

## 梯度和散度

:::{.definition}

1. 定义**梯度**算子 $\nabla: \ell^2(V)\to\ell^{2}_{-}(E)$ 为
   $$(\nabla f)(x,y) = c(x, y)\big[f(x)-f(y)\big]=c(e)\big[f(e^-)-f(e^+)\big].$$
   如果把 $f$ 理解为每个顶点处的电压的话，梯度算子给出的是电压之差除以电阻值，即经过边 $e$ 的有向电流。

2. 定义**散度**算子 $\mathrm{div}:\ell^{2}_{-}(E)\to\ell^2(V)$ 为
   $$(\mathrm{div}\,\theta)(x) = \frac{1}{c(x)}\sum_{y\sim x}\theta(x, y)=\frac{1}{c(x)}\sum_{e^-=x}\theta(e).$$
   上式右边可能有的求和项大于 0，有的小于 0。如果把 $\theta$ 理解为每条边上的有向电流的话，散度算子给出的是每个顶点处的净流出量。

3. 定义**拉普拉斯**算子 $\Delta:\ell^2(V)\to\ell^{2}(V)$ 为
   $$
   (\Delta f)(x) = (\mathrm{div}\,\nabla f)(x) = f(x)-\sum_{y\sim x}\frac{c(x,y)}{c(x)}f(y).
   $$
   如果 $(\Delta f)(x)=0$ 对 $x\in V$ 成立，我们就称 $f$ 在 $x$ 处是**调和**的。
:::

:::{.theorem #grad-div-conj}
梯度算子和散度算子是一对共轭算子：对任何 $f\in\ell^2(V)$ 和 $\theta\in\ell_{-}^2(E)$ 有
$$(f,\,\mathrm{div}\,\theta)_V = (\nabla f,\,\theta)_E.$$
:::

**证明**：上式两边关于 $f$ 是线性的，所以只要对 $\ell^2(V)$ 的一组基，即形如 $\ind{x}\,(x\in V)$ 的元素验证即可。这时左边是 $c(x)\cdot(\mathrm{div}\,\theta)(x)$，右边是 $\sum_{y\sim x}\theta(x,y)$，根据散度算子的定义，二者相等。$\blacksquare$

:::{.definition}
我们称映射 $\mathrm{div}$ 的核 $\mathrm{Ker\,div}$ 为环空间 (cycle space)，记作 $\lozenge$。称映射 $\nabla$ 的像 $\mathrm{Im}\nabla$ 为星空间 (star space)，记作 $\bigstar$。环空间和星空间都是 $\ell_{-}^2(E)$ 的子空间。
:::

:::{.theorem #cycle-star-direct-sum}
$\ell_{-}^2(E)=\lozenge\oplus\bigstar$。
:::

**证明**：由于 $\{\ind{x}\mid x\in V\}$ 构成 $\ell^2(V)$ 的一组基，所以它们在 $\nabla$ 下的像构成 $\bigstar$ 的一组基。根据 @Pre:grad-div-conj，对任何 $\theta\in\ell^2_{-}(E)$ 有
$$(\nabla \ind{x},\,\theta)_E=c(x)(\mathrm{div}\,\theta)(x).$$
于是 $\theta$ 与任何 $\nabla \ind{x}$ 正交当且仅当 $(\mathrm{div}\,\theta)(x)=0$ 对任何 $x\in V$ 成立，即当且仅当 $\theta\in\lozenge$，从而 $\lozenge$ 和 $\bigstar$ 互为正交补空间。$\blacksquare$

## 环空间和星空间的解释

我们来解释一下为什么这两个子空间叫做“环空间”和“星空间”。

首先是环空间。对任一 $e\in E$，记
$$\chi^e=\ind{e} - \ind{-e}\in\ell^2_{-}(E)$$
为边 $e$ 的示性函数，即 $\chi^e$ 在 $e$ 和 $-e$ 上取值分别为 $\pm1$，在其它边上都是 0。显然 $\chi^{e}=-\chi^{-e}$。

设 $e_1=(v_1,v_2), e_2=(v_2,v_3),\ldots,e_k=(v_k,v_1)$ 首尾相接构成一条回路 $C$，即
$$v_1\xarr{e_1}v_2\xarr{e_2}\cdots\xarr{e_{k-1}}v_k\xarr{e_k}v_1.$$

![](/images/electric-network/cycle.svg){width=150 .fig}

定义环函数 $f^C = \sum_{i=1}^k\chi^{e_i}$，则从 $v_1$ 出发绕 $C$ 一圈一路上经过的所有边 $f$ 的值都是 $+1$ （沿着反方向绕都是 $-1$），于是 $f^C$ 在 $C$ 包含的每个顶点上 1 进 1 出，在 $C$ 之外的顶点上 0 进 0 出，从而 $f^C\in\lozenge$。

我们断言 $\lozenge$ 可以由所有的环函数 $f^C$ 张成，这就是为什么 $\lozenge$ 叫做环空间。

设 $\theta\in\lozenge$，定义 $\theta$ 的支集为
$$\mathrm{supp}(\theta)=\{e\in E\mid\theta(e)\ne0\}.$$
如果 $\mathrm{supp}(\theta)$ 非空，则它必然包含一个回路，若不然，$\mathrm{supp}(\theta)$ 是一个森林，从而必然包含某个叶顶点（度数恰好为 1），这一点处的散度不可能为 0，矛盾！于是 $\mathrm{supp}(\theta)$ 包含一个回路 $C$，我们可以选择合适的常数 $\alpha$ 使得 $\widetilde{\theta}=\theta-\alpha f^C$ 在某个 $e\in C$ 上为 0，则 $\widetilde{\theta}$ 的支集严格小于 $\theta$。对 $\widetilde{\theta}$ 重复此操作一直下去必然可以在有限次后将支集变为空集，这就证明了 $\theta$ 可以表示为形如 $f^C$ 的线性组合。

星空间也有一个类似的形象描述。对每个顶点 $x$，我们也有一个 $\ell^2_{-}(E)$ 上的函数与之对应：$\sum_{e^-=x}c(e)\chi^e$。这个函数很直观，它的支集是从 $x$ 出发伸出去的星状结构。

![](/images/electric-network/div.svg){width=150 .fig}

对任何 $\theta\in\ell^2_{-}(E)$，我们有
$$(\mathrm{div}\,\theta)(x)=\sum_{e^-=x}\theta(e)=\sum_{e^-=x}\left(c(e)\chi^e,\theta\right)_E=\left(\sum_{e^-=x}c(e)\chi^e,\theta\right)_E.$$
由于 $\theta\in\lozenge$ 当且仅当 $(\mathrm{div}\,\theta)(x)=0$ 对所有 $\in V$ 成立，也就是 $\theta$ 与所有 $\sum_{e^-=x}c(e)\chi^e$ 正交，所以我们证明了 $\left\{\sum_{e^-=x}c(e)\chi^e\mid x\in V\right\}$ 可以生成 $\bigstar$。

# 网络中的流

设 $Z\subset V$ 是顶点集的一个子集，$a\notin Z$ 是一个顶点。

:::{.definition}
我们称 $\theta\in\ell_{-}^2(E)$ 是一个从 $a$ 到 $Z$ 的流，如果以下两个条件成立：

1. $(\mathrm{div}\,\theta)(a)\geq 0$。
2. 对任何 $x\notin \{a\}\cup Z$ 有 $(\mathrm{div}\,\theta)(x)=0$。

$a$ 叫做 $\theta$ 的**源点**，$Z$ 叫做 $\theta$ 的**汇点**。

定义流 $\theta$ 的**强度**为从源点 $a$ 流入网络的量：
$$\mathrm{strength}(\theta)=\sum_{x\sim a}\theta(a, x).$$
我们也把 $\mathrm{strength}(\theta)$ 记作 $\|\theta\|$，如果有 $\|\theta\|=1$ 成立，就称 $\theta$ 是一个**单位流**。

此外定义 $\theta$ 的**能量**为
$$\mathcal{E}(\theta)=(\theta,\,\theta)_E.$$
:::

这个定义蕴含了 $\sum_{z\in Z}(\mathrm{div}\,\theta)(z)=-(\mathrm{div}\,\theta)(a)$：考虑 $V$ 上的常函数 $1$，则 $\nabla 1=0$，于是 $$0=(\nabla 1,\,\theta)_E=(1,\,\mathrm{div}\,\theta)_V=(\mathrm{div}\,\theta)(a)+\sum_{z\in Z}(\mathrm{div}\,\theta)(z).$$ 即对整个网络来说，从 $a$ 流出的量等于流入 $Z$ 的量，中间没有任何“淤积”。

:::{.definition}
设 $\theta$ 是一个从 $a$ 到 $Z$ 的流，如果还有 $\theta=\nabla g\in\bigstar$ 成立，就称 $\theta$ 是一个**电流**，$g$ 叫做 $\theta$ 的电势。
:::

我们总结一下流和电流的特点：

1. 你可以把 $a$ 理解为电源正极，$Z$ 理解为网络接地的部分。
2. 流函数要求对任何 $x\notin \{a\}\cup Z$ 有 $(\mathrm{div}\,\theta)(x)=0$ 等价于物理中的基尔霍夫电流定律：任何中间节点的流量守恒。
3. 电流函数要求 $\theta=\nabla g\in\bigstar$ 等价于物理中的欧姆定律，即电流 $\theta$ 等于电势差除以电阻 $r(e)$。

# 电网络

本节我们将利用概率量给出网络的电势、电流、电阻的定义，这些定义都是纯数学的，但它们与物理含义都是一致的。


## 电势

:::{.definition}
设 $h:V\to\mathbb{R}$ 是实值函数，$h(a)=\alpha,\,h(Z)\equiv \beta$，且 $h$ 在任何 $x\notin \{a\}\cup Z$ 处调和。则我们称 $h$ 是一个**电势**函数。$\alpha,\beta$ 是边界条件。
:::


:::{.lemma}
给定边界条件 $\alpha,\beta\in\R$，电势函数 $h$ 是唯一确定的。
:::

**证明**：设 $h_1,h_2$ 都以 $\alpha,\beta$ 为边界条件，则 $g=h_1-h_2$ 以 $\alpha=\beta=0$ 为边界条件。如果 $g$ 不恒为 0 的话，设 $g$ 在 $x$ 处取得最大值 $M\ne0$。由于 $g$ 在 $x$ 处调和，所以
$$g(x) - \sum_{y\sim x}\frac{c(x,y)}{c(x)}g(y)=\sum_{y\sim x}\frac{c(x,y)}{c(x)}(M-g(y))=0.$$
从而对所有 $y\sim x$ 都有 $g(y)=M$。由于 $G$ 是连通的，这说明 $g(a)$ 或者 $g(Z)$ 也必须等于 $M$，矛盾。$\blacksquare$

我们来具体写出 $h$ 的构造。

记 $\{X_t,t\geq0\}$ 是从顶点 $x$ 出发，转移概率为 $P(x,y)=c(x,y)/c(x)$ 的随机游动，其中 $X_0=x$。$\{X_t\}$ 是可逆 Markov 链，以 $\{c(x),x\in V\}$ 为平稳测度：
$$c(x)P(x,y)=c(y)P(y,x).$$

设 $a$ 是一个顶点，$Z\subset V$ 是顶点集的子集，且 $a\notin Z$。记 $\tau_a,\tau_Z$ 分别是随机游动首次到达 $a$ 和 $Z$ 的时间。

考察概率
$$h_1(x) = \mathbb{P}_x(\tau_a<\tau_Z).$$
则 $h_1(x)$ 满足边界条件 $h_1(a)=1, h_1(Z)=0$。利用单步转移概率不难看出 $h_1(x)$ 在任何 $x\notin \{a\}\cup Z$ 上是**调和**的：
$$h_1(x)=\sum_{y\sim x}P(x, y)h_1(y).$$
所以 $h_1(x)$ 是边界条件 $\alpha=1,\,\beta=0$ 对应的电势。从而一般边界条件对应的电势为 $h=(\alpha-\beta)h_1 + \beta$。

## 等效电阻

:::{.definition}
设 $h$ 是电势函数，我们称 $\nabla h$ 为 $h$ 对应的电流。
:::

记 $\mathbb{P}(a\to Z)=\mathbb{P}_a(\tau_Z < \tau_a^+)$ 为从 $a$ 出发的随机游动在返回 $a$ 之前先到达 $Z$ 的概率。此概率称作从 $a$ 到 $Z$ 的**逃逸概率**。这里 $\tau_a^+=\max(\tau_a,1)$，表示随机游动严格地在未来某个时刻首次到达 $a$ 的时间（不计初始时刻）。

:::{.lemma #v-div-i}
设 $h$ 是电势，$i=\nabla h$ 是对应的电流，则
$$\frac{h(a) - h(Z)}{\| i\|} = \frac{1}{c(a)\mathbb{P}(a\to Z)}.$$
:::

**证明**：设 $h_1(x) = \mathbb{P}_x(\tau_a<\tau_Z)$。由 $h=(h(a)-h(Z))h_1+h(Z)$ 可得
$$1-h_1(x)=\frac{h(a)-h(x)}{h(a)-h(Z)}.$$
于是

$$
\begin{aligned}
\mathbb{P}(a\to Z) &= \sum_{x\sim a}P(a, x)\mathbb{P}_x(\tau_Z < \tau_a)\\&=
\sum_{x\sim a}\frac{c(a,x)}{c(a)}\left(1-h_1(x)\right)\\&=
\sum_{x\sim a}\frac{c(a,x)}{c(a)}\frac{h(a)-h(x)}{h(a)-h(Z)}\\&=
\frac{\sum_{x\sim a}(\nabla h)(a, x)}{c(a)(h(a)-h(Z))}\\&=
\frac{\sum_{x\sim a} i(a,x)}{c(a)(h(a)-h(Z))}\\&=
\frac{\|i\|}{c(a)(h(a)-h(Z))}.
\end{aligned}
$$

$\blacksquare$

:::{.definition}
我们称
$$\Reff = \frac{1}{c(a)\mathbb{P}(a\to Z)}$$
为网络的**等效电阻**。
:::


## Green 函数

:::{.definition}
定义 **Green 函数**
$$\mathcal{G}_Z(a, x) = \sum_{0\leq k<\tau_Z}\mathbb{1}_{\{X_k=x\}}.$$
为从 $a$ 出发的随机游动在首次到达 $Z$ 之前访问 $x$ 的期望次数。
:::

:::{.lemma #green-function}
Green 函数 $\mathcal{G}_Z(a, x)$ 满足如下的条件：

1. $\mathcal{G}_Z(a, Z)=0$；
2. $\mathcal{G}_Z(a, a)=\dfrac{1}{\mathbb{P}(a\to Z)}$；
3. $\dfrac{\mathcal{G}_Z(a, x)}{c(x)}$ 在任何 $x\notin\{a\}\cup Z$ 处是调和的。
:::

**证明**：由于随机游动在首次到达 $Z$ 之前不可能访问 $Z$，所以 1 是显然的。

对从 $a$ 出发的随机游动，随机变量
$$Y = \begin{cases}
1 & \tau_Z < \tau_a^+,\\
0 & \tau_Z \geq \tau_a^+.
\end{cases}$$
是一个服从参数为 $p=\mathbb{P}(a\to Z)$ 的几何分布的随机变量，其期望为 $\frac{1}{\mathbb{P}(a\to Z)}$，正是随机游动在首次访问 $Z$ 之前回到 $a$ 的期望次数（首次实验成功等待时间的期望），即 $\mathcal{G}_Z(a, a)$，所以 2 得证。

再证明任意中间节点 $x$ 处的调和性质。对 $x$ 的任何邻居 $y\sim x$，定义随机变量 $N_{y\to x}^Z$ 为从 $a$ 出发的随机游动在访问 $Z$ 之前从 $y$ 走到 $x$ 的次数。由于随机游动必然是从某个 $y\sim x$ 走过去访问 $x$，所以
$$\mathcal{G}_Z(a, x)=\sum_{y\sim x}\mathbb{E}[N_{y\to x}^Z].$$

另一方面
$$
\begin{aligned}
\mathbb{E}[N_{y\to x}^Z]&=
\mathbb{E}\left[\sum_{0\leq t<\tau_Z}\ind{X_t=y,\,X_{t+1}=x}\right]\\&=
\sum_{0\leq t<\tau_Z}\mathbb{P}\left[X_t=y,\,X_{t+1}=x\right]\\&=
\sum_{0\leq t<\tau_Z}\mathbb{P}(X_t=y)P(y,x)\\&=
P(y,x)\mathbb{E}\left[\sum_{0\leq t<\tau_Z}\ind{X_t=y}\right]\\&=
P(y,x)\mathcal{G}_Z(a,y).
\end{aligned}
\label{eq:cross}
$$

所以

$$
\frac{\mathcal{G}_Z(a, x)}{c(x)} =\frac{1}{c(x)}\sum_{y\sim x}P(y,x)\mathcal{G}_Z(a,y)=\sum_{y\sim x}P(x,y)\frac{\mathcal{G}_Z(a,y)}{c(y)}.
$$

其中我们使用了 Markov 链的可逆性：$c(x)P(x,y)=c(y)P(y,x)$。这就证明了 3。$\blacksquare$

:::{.corollary}
$v(x)=\dfrac{\mathcal{G}_Z(a, x)}{c(x)}$ 是满足边界条件
$$v(a)=\Reff,\quad v(Z)\equiv0.$$
的电势函数。$v$ 对应的电流 $i$ 是单位流：$\|i\|=1$。
:::

**证明**：结合 @Pre:v-div-i 和 @Pre:green-function 即得。$\blacksquare$

## 能量

记 $P_\bigstar$ 为从 $\ell^2_{-}(E)$ 沿着 $\lozenge$ 到 $\bigstar$ 的投影算子，则 $P_\bigstar$ 是自共轭算子。


:::{.theorem #unit-flow}
在所有从 $a$ 到 $Z$ 的单位流中，电流的能量最小。并且电流的能量等于 $\Reff$。
:::

**证明**：设 $f,g$ 是任何这样的两个单位流，则 $f-g$ 处处净流量为 0，即 $f-g\in\lozenge$，从而 $P_\bigstar (f-g) = 0$，即 $P_\bigstar f= P_\bigstar g$。于是我们证明了任何从 $a$ 到 $Z$ 的单位流在 $P_\bigstar$ 下有相同的投影。记这个投影为 $i$，则 $i$ 是仍然是从 $a$ 到 $Z$ 的单位流且 $i\in\bigstar$，所以 $i$ 是电流。由于 $i\perp f-i$，所以
$$\mathcal{E}(f)=(f,\,f)_{E} = (i,i)_{E} + (f-i,f-i)_{E}\geq (i,i)_{E}=\mathcal{E}(i).$$
这就证明了电流能量的最小性。

为了证明 $\mathcal{E}(i)=\Reff$，我们任取从 $a$ 到 $Z$ 的单位流 $f$，则
$$(i,i)_E = (i, P_\bigstar f)_E  = (P_\bigstar i, f)_E =(i,f)_E.$$
其中 $U(x)-U(y)$ 是 $x,y$ 之间的电势差，而流入网络的总电流是 1，所以这个电势差等于网络的等效电阻。$\blacksquare$




[^1]: Lyons, Russell, and Peres, Yuval. 2016. Probability on Trees and Networks. Cambridge Series in Statistical and Probabilistic Mathematics, vol. 42.
[^2]: Richard Stanley. 2013. Algebraic Combinatorics: Walks, Trees, Tableaux, and More. Undergraduate Texts in Mathematics. Springer-Verlag New York.
