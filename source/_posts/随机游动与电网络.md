---
title: "随机游动与电网络"
date: 2014-10-06
categories: [随机游动]
url: "random-walk-and-electric-network"
---

\newcommand{\ind}[1]{\mathbf{1}_{\{ #1 \}}}
\newcommand{\xarr}[1]{\xrightarrow{\ #1 \ }}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Reff}{\mathcal{R}_{\rm eff}(a\to Z)}
\newcommand{\Reffprime}{\mathcal{R}'_{\rm eff}(a\to Z)}
\newcommand{\Div}{\mathrm{div}}
\newcommand{\Reffinf}{\mathcal{R}_{\rm eff}(a\to \infty)}

# 图上的线性代数

一个**网络** $\mathcal{N}=(G, c)$ 由一个有限图 $G=(V,E)$ 和一个权值函数 $c:E\to\mathbb{R}_{\geq0}$ 组成。这里 $G$ 是连通的无向图，其每条边 $e\in E$ 有一个权值 $c(e)\in[0, +\infty)$，$c(e)$ 叫做 $e$ 的**电导**，$r(e)=1/c(e)$ 叫做 $e$ 的**电阻**。

设 $x,y\in V$ 是两个顶点，我们用 $x\sim y$ 表示 $x,y$ 是相邻的。当 $e=(x,y)$ 时，我们称 $e^-=x$ 为 $e$ 的**尾部**，$e^+=y$ 为 $e$ 的**头部**。记 $-e=(y,x)$ 为 $e$ 的**反向边**。在反向边 $-e$ 中 $x$ 变为头部，$y$ 变为尾部。

**我们约定 $E$ 总是同时包含一条边 $e=(x,y)$ 和它的反向边 $-e=(y,x)$**。此外，我们用记号 $E_{1/2}$ 表示对每个 $e$，在 $e$ 和 $-e$ 中任选一个组成的集合。$E_{1/2}$ 的一个选取方式对应 $G$ 的一个定向，不过在本文中，我们并不需要明确写出这个选取方式。

对 $e=(x,y)\in E$，我们也记 $c(x,y)=c(e)$。**我们要求电导函数 $c(x,y)$ 关于 $x,y$ 是对称的：$c(x,y)=c(y,x)$**。即在书写 $c(e)$ 的时候我们不用关心 $e$ 的定向。设 $x\in V$ 是一个顶点，记 $c(x)=\sum_{y\sim x}c(x,y)$ 是与 $x$ 相邻的所有边的电导之和。

## $\ell^2(V)$ 和 $\ell^2_-(E)$

:::{.definition}
所有 $V$ 上的实值函数 $f:V\to\mathbb{R}$ 构成一个内积空间 $\ell^2(V)$：
$$(f,\, g)_V = \sum_{x\in V}c(x)f(x)g(x).$$
:::

:::{.definition}
所有 $E$ 上的**反对称**实值函数 $\theta: E\to\mathbb{R}$ 也构成一个内积空间 $\ell^2_{-}(E)$：
$$(\theta,\,\theta')_E = \frac{1}{2}\sum_{e\in E}r(e)\theta(e)\theta'(e)=\sum_{e\in E_{1/2}}r(e)\theta(e)\theta'(e).$$
:::

这里 $\theta$ 是反对称函数的意思是，对任何 $e=\{x,y\}$ 有 $\theta(x, y)=-\theta(y,x)$。注意上式右边的求和与边的定向是无关的，因为如果把 $e$ 换成 $-e$ 的话，$\theta(e),\theta'(e)$ 同时变号，它们的乘积还是不变的。即内积 $(\cdot\,,\cdot)_E$ 的定义与 $E_{1/2}$ 的选取方式无关。


## $\nabla$ 算子和 $\Div$ 算子

:::{.definition}
定义**梯度**算子 $\nabla: \ell^2(V)\to\ell^{2}_{-}(E)$ 为
$$(\nabla f)(x,y) = c(x, y)\big[f(x)-f(y)\big]=c(e)\big[f(e^-)-f(e^+)\big].$$

显然 $\nabla$ 是线性映射。
:::

如果把 $f$ 理解为每个顶点处的电压的话，$\nabla$ 算子给出的是电压之差除以电阻值，即经过边 $e$ 的有向电流。

:::{.definition}

定义**散度**算子 $\mathrm{div}:\ell^{2}_{-}(E)\to\ell^2(V)$ 为
$$(\Div\,\theta)(x) = \frac{1}{c(x)}\sum_{y\sim x}\theta(x, y)=\frac{1}{c(x)}\sum_{e^-=x}\theta(e).$$

显然 $\Div$ 也是线性映射。
:::

如果把 $\theta$ 理解为每条边上的有向电流的话，$\Div$ 算子给出的是每个顶点处的净流出量除以 $c(x)$。

:::{.theorem #grad-div-conj}
$\nabla$ 和 $\Div$ 是一对共轭算子：对任何 $f\in\ell^2(V)$ 和 $\theta\in\ell_{-}^2(E)$ 有
$$(f,\,\Div\,\theta)_V = (\nabla f,\,\theta)_E.$$
:::

**证明**：上式两边关于 $f$ 是线性的，所以只要对 $\ell^2(V)$ 的一组基 $\{\ind{x}\mid x\in V\}$ 验证即可。这时左边是 $c(x)\cdot(\mathrm{div}\,\theta)(x)$，右边是 $\sum_{y\sim x}\theta(x,y)$，根据 $\Div$ 的定义，二者相等。$\blacksquare$

## $\lozenge$ 空间和 $\bigstar$ 空间

:::{.definition}
我们称映射 $\Div$ 的核 $\mathrm{Ker\,div}$ 为环空间 (cycle space)，记作 $\lozenge$。映射 $\nabla$ 的像 $\mathrm{Im}\nabla$ 为星空间 (star space)，记作 $\bigstar$。环空间和星空间都是 $\ell_{-}^2(E)$ 的子空间。
:::

:::{.theorem #cycle-star-direct-sum}
$\ell_{-}^2(E)=\lozenge\oplus\bigstar$。
:::

**证明**：由于 $\{\ind{x}\mid x\in V\}$ 构成 $\ell^2(V)$ 的一组基，所以它们在 $\nabla$ 下的像构成 $\bigstar$ 的一组基。根据 @Pre:grad-div-conj，对任何 $\theta\in\ell^2_{-}(E)$ 有
$$(\nabla \ind{x},\,\theta)_E=c(x)(\mathrm{div}\,\theta)(x).$$
于是 $\theta$ 与任何 $\nabla \ind{x}$ 正交当且仅当 $(\mathrm{div}\,\theta)(x)=0$ 对任何 $x\in V$ 成立，即 $\theta\perp\bigstar$ 当且仅当 $\theta\in\lozenge$，这说明 $\lozenge$ 和 $\bigstar$ 互为正交补空间。$\blacksquare$

### 环空间和星空间的解释

我们来解释为什么称 $\lozenge$ 和 $\bigstar$ 为“环空间”和“星空间”。

首先是环空间。对任意 $e\in E$，记
$$\chi^e=\ind{e} - \ind{-e}\in\ell^2_{-}(E)$$
为边 $e$ 的示性函数，即 $\chi^e$ 在 $e$ 和 $-e$ 上取值分别为 $\pm1$，在其它边上都是 0。当然 $\chi^{e}=-\chi^{-e}$。

设 $e_1=(v_1,v_2), e_2=(v_2,v_3),\ldots,e_k=(v_k,v_1)$ 首尾相接构成一条回路 $C$：
$$v_1\xarr{e_1}v_2\xarr{e_2}\cdots\xarr{e_{k-1}}v_k\xarr{e_k}v_1.$$

![](/images/electric-network/cycle.svg){width=150 .fig}

定义环函数 $f^C = \sum_{i=1}^k\chi^{e_i}$，则 $f^C$ 在 $C$ 包含的每个顶点上 1 进 1 出，在 $C$ 之外的顶点上 0 进 0 出，从而每个 $f^C$ 在所有顶点处的净流量为 0，即 $f^C\in\lozenge$。

:::{.proposition}
$\lozenge$ 可以由所有的 $f^C$ 张成。
:::

这个命题解释了为什么 $\lozenge$ 叫做环空间。

**证明**：设 $\theta\in\lozenge$，定义 $\theta$ 的支集为
$$\mathrm{supp}(\theta)=\{e\in E\mid\theta(e)\ne0\}.$$
如果 $\mathrm{supp}(\theta)$ 非空，则它必然包含一个回路，若不然，$\mathrm{supp}(\theta)$ 是一个森林，从而必然包含某个叶顶点（度数恰好为 1），这一点处的散度不可能为 0，矛盾！于是 $\mathrm{supp}(\theta)$ 包含一个回路 $C$，我们可以选择合适的常数 $\alpha$ 使得 $\widetilde{\theta}=\theta-\alpha f^C$ 在某个 $e\in C$ 上为 0，则 $\widetilde{\theta}$ 的支集严格小于 $\theta$。对 $\widetilde{\theta}$ 重复此操作一直下去必然可以在有限次后将支集变为空集，这就证明了 $\theta$ 可以表示为形如 $f^C$ 的线性组合。$\blacksquare$

星空间也有一个类似的形象描述。对每个顶点 $x$，我们也有一个 $\ell^2_{-}(E)$ 上的函数与之对应：$\sum_{e^-=x}c(e)\chi^e$。这个函数很直观，它的支集是从 $x$ 出发伸出去的星状结构：

![](/images/electric-network/div.svg){width=150 .fig}

:::{.proposition}
$\bigstar$ 可以由 $\left\{\sum_{e^-=x}c(e)\chi^e\mid x\in V\right\}$ 张成。
:::

**证明**：我们只要证明，对任一 $\theta\in\ell^2_{-}(E)$，如果 $\theta$ 与任何形如 $\sum_{e^-=x}c(e)\chi^e$ 的元素正交，则必有 $\theta\in\lozenge$ 即可。我们有
$$\left(\sum_{e^-=x}c(e)\chi^e,\theta\right)_E = \sum_{e^-=x}\left(c(e)\chi^e,\theta\right)_E = \sum_{e^-=x}\theta(e).$$
所以 $\theta\perp\sum_{e^-=x}c(e)\chi^e\Rightarrow(\Div\,\theta)(x)=0$。由 $x$ 的任意性即得 $\theta\in\lozenge$。$\blacksquare$

## 流

设 $Z\subset V$ 是顶点集的一个子集，$a\notin Z$ 是一个顶点。

:::{.definition}
设 $\theta\in\ell_{-}^2(E)$，如果对任何 $x\notin \{a\}\cup Z$ 有 $(\Div\,\theta)(x)=0$ 成立，我们就称 $\theta$ 是一个**流**。如果还有 $(\Div\,\theta)(a)\geq 0$ 成立，就称 $\theta$ 是一个从 $a$ 到 $Z$ 的流。这是 $a$ 叫做 $\theta$ 的**源点**，$Z$ 叫做 $\theta$ 的**汇点**。

定义流 $\theta$ 的**强度** $\|\theta\|$ 为从源点 $a$ 流入网络的量：
$$\|\theta\|=\sum_{x\sim a}\theta(a, x) = c(a)(\Div\,\theta)(a).$$
如果有 $\|\theta\|=1$ 成立，就称 $\theta$ 是一个**单位流**。

此外定义 $\theta$ 的**能量**为
$$\mathcal{E}(\theta)=(\theta,\,\theta)_E.$$
:::

对任何 $x\notin \{a\}\cup Z$ 有 $(\Div\,\theta)(x)=0$ 这个要求等价于物理中的基尔霍夫电流定律：任何中间节点的流入等于流出。

这个定义蕴含了
$$\sum_{z\in Z}\sum_{w\sim z}\theta(w, z)=\|\theta\|.$$
即从 $a$ 处进入网络的总流量 $\|\theta\|$ 等于网络汇聚到 $Z$ 的流量之和，中间没有任何“淤积”。为了看到这一点，只要考虑 $V$ 上的常函数 $1$，由于 $\nabla 1\equiv 0$，所以
$$\begin{aligned}
0&=(\nabla 1,\,\theta)_E=(1,\,\Div\,\theta)_V\\
&=c(a)(\Div\,\theta)(a)+\sum_{z\in Z}c(z)(\Div\,\theta)(z)\\
&=\|\theta\| + \sum_{z\in Z}\sum_{w\sim z}\theta(z, w).\end{aligned}.$$

:::{.definition}
设 $\theta$ 是一个从 $a$ 到 $Z$ 的流，如果还有 $\theta=\nabla g\in\bigstar$ 成立，就称 $\theta$ 是一个**电流**，$g$ 叫做 $\theta$ 的电势。
:::

$\theta\in\bigstar$ 这个要求等价于物理中的欧姆定律。

在给定强度的情况下，从 $a$ 到 $Z$ 的电流是唯一确定的：

:::{.lemma #unique-current}
设 $\theta_1,\theta_2$ 是两个从 $a$ 到 $Z$ 的电流，且 $\|\theta_1\|=\|\theta_2\|$，则 $\theta_1=\theta_2$。
:::
**证明**：根据已知 $\theta_1-\theta_2$ 处处散度为 0，从而 $\theta_1-\theta_2\in\bigstar\cap\lozenge=\{0\}$。$\blacksquare$


## 电势

:::{.definition}
设 $f:V\to\mathbb{R}$。定义**拉普拉斯算子** $\Delta: V\to\mathbb{R}$ 为 $\Delta = \Div \cdot \nabla$，即
$$(\Delta\, f)(x) = (\Div\cdot\nabla f)(x) = f(x) - \sum_{y\sim x}\frac{c(x,y)}{c(x)}f(y).$$
如果有 $(\Delta\, f)(x)=0$ 成立，就称 $f$ 在 $x$ 处**调和**。
:::

:::{.definition}
设 $h:V\to\mathbb{R}$ 满足 $h(a)=\alpha,\,h|_Z\equiv\beta$，且 $h$ 在任何 $x\notin \{a\}\cup Z$ 处调和。
则我们称 $h$ 是一个**电势**函数。$\alpha,\beta$ 叫做边界条件。
:::

:::{.lemma}
给定边界条件 $\alpha,\beta\in\R$，电势函数 $h$ 是唯一确定的。
:::

**证明**：设 $h_1,h_2$ 都以 $\alpha,\beta$ 为边界条件，则 $g=h_1-h_2$ 在 $\{a\}\cup Z$ 上取值都是 0。如果 $g$ 不恒为 0 的话，则 $g$ 的最大值或者最小值中有一个不为 0。不妨设 $g$ 的最大值 $M\ne0$ 且 $g(x)=M$。由于 $g$ 在 $x$ 处调和，所以
$$g(x) - \sum_{y\sim x}\frac{c(x,y)}{c(x)}g(y)=\sum_{y\sim x}\frac{c(x,y)}{c(x)}(M-g(y))=0.$$
上式右边每一项都是非负的，因此只能是 $M-g(y)=0$，即对所有 $y\sim x$ 都有 $g(y)=M$。由于 $G$ 是连通的，这说明 $g(a)$ 或者 $g|_Z$ 之一也必须等于 $M$，矛盾。$\blacksquare$

:::{.lemma #potential-gives-flow}
设 $a,Z$ 如前，$h$ 是电势函数，则 $\nabla h$ 是电流。
:::

**证明**：记 $i=\nabla h\in\bigstar$。只要再说明 $i$ 是流即可。为此只要验证 $i$ 在任何 $x\notin\{a\}\cup Z$ 处流量守恒：
$$(\Div\,i)(x)=\frac{1}{c(x)}\sum_{y\sim x}i(x, y)=0.$$
然而 $i(x,y)=(\nabla h)(x,y) = c(x,y)(h(x) - h(y))$，所以上式右边等于
$$\frac{1}{c(x)}\sum_{y\sim x}c(x,y)(h(x) - h(y))=h(x) -\frac{1}{c(x)}\sum_{y\sim x}c(x,y)h(y).$$
由 $h$ 在 $x$ 处调和即得结论。$\blacksquare$


# 概率解释

本节我们将利用概率量给出网络的电势、电流、电阻的定义，这些定义都是纯数学的，但它们与物理含义都是一致的。

记 $\{X_t,t\geq0\}$ 是从顶点 $x$ 出发，转移概率为 $P(x,y)=c(x,y)/c(x)$ 的随机游动，其中 $X_0=x$。$\{X_t\}$ 是可逆 Markov 链，以 $\{c(x),x\in V\}$ 为平稳测度：
$$c(x)P(x,y)=c(y)P(y,x).$$
记 $\tau_a,\tau_Z$ 分别是随机游动首次到达 $a$ 和 $Z$ 的时间。考察概率
$$v(x) = \mathbb{P}_x(\tau_a<\tau_Z).$$
$v(x)$ 满足边界条件 $v(a)=1,\,v|_Z\equiv0$。利用单步转移分析易得 $v(x)$ 在任何 $x\notin \{a\}\cup Z$ 处调和，
所以 $v(x)$ 是电势。于是一般边界条件 $h(a)=\alpha,\,h|_Z\equiv\beta$ 对应的电势为
$$h=(\alpha-\beta)v + \beta.$$


## 等效电阻


记 $\mathbb{P}(a\to Z)=\mathbb{P}_a(\tau_Z < \tau_a^+)$ 为从 $a$ 出发的随机游动在返回 $a$ 之前先到达 $Z$ 的概率。此概率称作从 $a$ 到 $Z$ 的**逃逸概率**。这里 $\tau_a^+=\max(\tau_a,1)$，表示随机游动严格地在未来某个时刻首次到达 $a$ 的时间（初始时刻位于 $a$ 不算在内）。

:::{.lemma #v-div-i}
设 $h$ 是电势，$i=\nabla h$ 是对应的电流，则
$$\frac{h(a) - h|_Z}{\| i\|} = \frac{1}{c(a)\mathbb{P}(a\to Z)}.$$
:::

**证明**：设 $v(x) = \mathbb{P}_x(\tau_a<\tau_Z)$。记 $h(a)=\alpha$ 和 $h|_Z\equiv\beta$。由 $h=(\alpha-\beta)v+\beta$ 可得
$$1-v(x)=\frac{\alpha-h(x)}{\alpha-\beta}.$$
于是

$$
\begin{aligned}
\mathbb{P}(a\to Z) &= \sum_{x\sim a}P(a, x)\mathbb{P}_x(\tau_Z < \tau_a)\\&=
\sum_{x\sim a}\frac{c(a,x)}{c(a)}\left(1-v(x)\right)\\&=
\sum_{x\sim a}\frac{c(a,x)}{c(a)}\frac{\alpha-h(x)}{\alpha-\beta}\\&=
\frac{\sum_{x\sim a}(\nabla h)(a, x)}{c(a)(\alpha-\beta)}\\&=
\frac{\sum_{x\sim a} i(a,x)}{c(a)(\alpha-\beta)}\\&=
\frac{\|i\|}{c(a)(\alpha-\beta)}.
\end{aligned}
$$

$\blacksquare$

:::{.definition}
我们称
$$\Reff = \frac{1}{c(a)\mathbb{P}(a\to Z)}$$
为网络的**等效电阻**。
:::

根据 @Pre:v-div-i，我们可以用任何电势 $h$，通过除以 $h$ 对应的电流强度来计算等效电阻。

## Green 函数

:::{.definition}
定义 **Green 函数**
$$\mathcal{G}_Z(a, x) = \sum_{0\leq k<\tau_Z}\mathbb{1}_{\{X_k=x\}}.$$
为从 $a$ 出发的随机游动在首次到达 $Z$ 之前访问 $x$ 的期望次数。
:::

:::{.lemma #green-function}
Green 函数 $\mathcal{G}_Z(a, x)$ 满足如下的条件：

1. $\mathcal{G}_Z(a, Z)=0$；
2. $\mathcal{G}_Z(a, a)=\dfrac{1}{\mathbb{P}(a\to Z)}$；
3. $\dfrac{\mathcal{G}_Z(a, x)}{c(x)}$ 在任何 $x\notin\{a\}\cup Z$ 处是调和的。
:::

**证明**：由于随机游动在首次到达 $Z$ 之前不可能访问 $Z$，所以 1 是显然的。

对从 $a$ 出发的随机游动，随机变量
$$Y = \begin{cases}
1 & \tau_Z < \tau_a^+,\\
0 & \tau_Z \geq \tau_a^+.
\end{cases}$$
是一个服从参数为 $p=\mathbb{P}(a\to Z)$ 的几何分布的随机变量，其期望为 $\frac{1}{\mathbb{P}(a\to Z)}$，正是随机游动在首次访问 $Z$ 之前回到 $a$ 的期望次数（首次实验成功等待时间的期望），即 $\mathcal{G}_Z(a, a)$，所以 2 得证。

再证明任意中间节点 $x$ 处的调和性质。对 $x$ 的任何邻居 $y\sim x$，定义随机变量 $N_{y\to x}^Z$ 为从 $a$ 出发的随机游动在访问 $Z$ 之前从 $y$ 走到 $x$ 的次数：
$$N_{y\to x}^Z =\sum_{0\leq t<\tau_Z}\ind{X_t=y,\,X_{t+1}=x}.$$
由于随机游动必然是从某个 $y\sim x$ 走过去访问 $x$，所以
$$\mathcal{G}_Z(a, x)=\sum_{y\sim x}\mathbb{E}[N_{y\to x}^Z].$$

另一方面
$$
\begin{aligned}
\mathbb{E}[N_{y\to x}^Z]&=
\mathbb{E}\left[\sum_{0\leq t<\tau_Z}\ind{X_t=y,\,X_{t+1}=x}\right]\\&=
\sum_{0\leq t<\tau_Z}\mathbb{P}\left[X_t=y,\,X_{t+1}=x\right]\\&=
\sum_{0\leq t<\tau_Z}\mathbb{P}(X_t=y)P(y,x)\\&=
P(y,x)\mathbb{E}\left[\sum_{0\leq t<\tau_Z}\ind{X_t=y}\right]\\&=
P(y,x)\mathcal{G}_Z(a,y).
\end{aligned}
\label{eq:cross}
$$

所以

$$
\frac{\mathcal{G}_Z(a, x)}{c(x)} =\frac{1}{c(x)}\sum_{y\sim x}P(y,x)\mathcal{G}_Z(a,y)=\sum_{y\sim x}P(x,y)\frac{\mathcal{G}_Z(a,y)}{c(y)}.
$$

其中我们使用了 Markov 链的可逆性：$c(x)P(x,y)=c(y)P(y,x)$。这就证明了 3。$\blacksquare$

:::{.corollary #current-by-green}
$v(x)=\dfrac{\mathcal{G}_Z(a, x)}{c(x)}$ 是满足边界条件
$$v(a)=\Reff,\quad v(Z)\equiv0.$$
的电势函数。$v$ 对应的电流 $i$ 是单位流：$\|i\|=1$。
:::

**证明**：结合 @Pre:v-div-i 和 @Pre:green-function 即得。$\blacksquare$

## 能量

记 $P_\bigstar$ 为从 $\ell^2_{-}(E)$ 沿着 $\lozenge$ 到 $\bigstar$ 的投影算子，则 $P_\bigstar$ 是自共轭算子。


:::{.theorem #unit-flow}
**Thomson 原理** \

在所有从 $a$ 到 $Z$ 的单位流中，单位电流的能量最小。并且其能量等于 $\Reff$。
:::

**证明**：设 $f,g$ 是任何这样的两个单位流，则 $f-g$ 处处净流量为 0，即 $f-g\in\lozenge$，从而 $P_\bigstar (f-g) = 0$，即 $P_\bigstar f= P_\bigstar g$。于是我们证明了任何从 $a$ 到 $Z$ 的单位流在 $P_\bigstar$ 下有相同的投影。记这个投影为 $i$，则 $i$ 是仍然是从 $a$ 到 $Z$ 的单位流且 $i\in\bigstar$，所以 $i$ 是电流。由于 $i\perp f-i$，所以
$$\mathcal{E}(f)=(f,\,f)_{E} = (i,i)_{E} + (f-i,f-i)_{E}\geq (i,i)_{E}=\mathcal{E}(i).$$
这就证明了电流能量的最小性。

为了证明 $\mathcal{E}(i)=\Reff$，我们取 @Pre:current-by-green 中的电势 $v$，则 $i=\nabla v$，于是
$$(i,i)_E = (i, \nabla v)_E = (\Div\,i, v)_V=v(a)-v(Z)=\Reff.$$
$\blacksquare$

:::{.theorem #thompson}
**Rayleigh 定律** \

$\Reff$ 关于电阻是单调递增的，即如果将网络的电阻修改为 $\{r'(e)\}$，使得对任何 $e\in E$ 有 $r'(e)\geq r(e)$ 成立，则新网络的等效电阻 $\Reffprime\geq\Reff$。
:::

**证明**：设 $i$ 是原网络 $\{r(e)\}$ 中的单位电流，根据 @Prev:unit-flow 有 $\mathcal{E}(i)=\Reff$。$i$ 也是新网络中的单位流，但未必是电流，仍然由 @Prev:unit-flow 有 $\mathcal{E}(i)\geq\Reffprime$。$\blacksquare$

:::{.definition}
设 $f\in\ell^2(V)$。定义 $f$ 的能量 $\mathcal{E}(f)$ 为
$$\mathcal{E}(f) = (\nabla f, \nabla f)_E.$$
:::

:::{.theorem #dirichlet}
**Dirichlet 原理** \

$$\frac{1}{\Reff} = \inf\{ \mathcal{E}(f)\mid f: V\to\mathbb{R}, \,f(a)=1,\, f|_Z\equiv 0\}.$$

并且当 $f$ 在任何 $x\notin\{a\}\cup Z$ 处调和时取得下确界。
:::

**证明**：记右边的集合为 $S_f$。记 $v(x)=\mathbb{P}_x(\tau_a < \tau_Z)$，则 $v\in S_f$ 且 $v$ 在任何 $x\notin\{a\}\cup Z$ 处调和。问题等价于证明对任何 $f\in S_f$ 有
$$\mathcal{E}(f)\geq\mathcal{E}(v)=\frac{1}{\Reff}.$$
令 $\phi=\Reff v$，根据 @Pre:current-by-green，$i=\nabla \phi$ 是从 $a$ 到 $Z$ 的单位电流，于是由 @Prev:unit-flow 得到
$$\mathcal{E}(\phi)=(\nabla\phi, \nabla\phi)_E=(i,i)_E=\Reff.$$
又因为 $\mathcal{E}(\phi)=\Reff^2\mathcal{E}(v)$，我们得到 $\mathcal{E}(v)=1/\Reff$。

另一方面，将 $f\in S_f$ 写成 $f=v+g$，其中 $g=f-v$。$g$ 满足 $g(a)=0,\,g\mid_Z\equiv0$。我们断言在 $\ell^2_-(E)$ 中有 $\nabla v\perp \nabla g$。这是因为
$$(\nabla v,\nabla g)_E = (\Div\,\nabla v,g)_V=(\Delta v,g)_V=\sum_{x\in V}c(x)(\Delta v)(x)\cdot g(x).$$
在上面右边的求和中，对 $x\not\in\{a\}\cup Z$ 有 $(\Delta v)(x)=0$；对 $x\in\{a\}\cup Z$ 有 $g(x)=0$。因此上式等于 0，即 $\nabla v\perp \nabla g$。从而 $\nabla f=\nabla v+\nabla g$ 直和分解，于是
$$\mathcal{E}(f)=(\nabla f,\nabla f)_E=(\nabla v,\nabla v)_E+(\nabla g,\nabla g)_E\geq\mathcal{E}(v).$$
$\blacksquare$

# 无限图

现在我们把讨论扩展到无限图。设 $G=(V,E)$ 是一个有可数多个顶点、连通、局部有限的图，局部有限的含义是每个顶点的度数都是有限的。固定一个顶点 $a$，并取 $G$ 的单调递增的子图序列 $\{G_n\}_{n=0}^\infty\uparrow G$ 使得 $G_0=\{a\}$ 以及 $a\in G_n$ 对任何 $n$ 成立。这样的序列总是存在的，例如可以取 $G_n$ 为以 $a$ 为中心，所有与 $a$ 的距离不超过 $n$ 的顶点构成的子图。令 $Z_n=G\setminus G_n$，由于从 $a$ 出发的随机游动逃逸到 $Z_{n+1}$ 自然也就逃逸到了 $Z_n$，所以序列 $\{\mathbb{P}(a\to Z_n)\}$ 单调下降，因此极限 $$\mathbb{P}(a\to \infty)=\lim_{n\to\infty}\mathbb{P}(a\to Z_n).$$
存在。这个极限不依赖于序列 $\{G_n\}$ 的选取，这是因为，任何两个不同的子图序列都必然交织嵌套在一起，因此根据 squeezing 原理，$\mathbb{P}(a\to \infty)$ 是合理定义的。
于是等效电阻的极限
$$\lim_{n\to\infty}\mathrm{Reff}(a\to Z_n)=\lim_{n\to\infty}\frac{1}{c(a)\mathbb{P}(a\to Z_n)}=\Reffinf.$$
同样存在，这正是 $a$ 点到网络无穷远处的有效电阻。

根据恒等式
$$1=\mathbb{P}(\tau_a^+<\tau_{Z_n}) + \mathbb{P}(\tau_{Z_n}<\tau_a^+).$$
两边令 $n\to\infty$，可得
$$1=\mathbb{P}(\tau_a^+<\infty) + \mathbb{P}(a\to Z_n).$$
由于随机游动常返当且仅当 $\mathbb{P}(\tau_a^+<\infty)=1$，即当且仅当 $\mathbb{P}(a\to Z_n)=0$，也就即 $\Reffinf<\infty$。

:::{.lemma}
设 $i_n$ 是 $G_n$ 上从 $a$ 到 $Z_n$ 的单位电流，并且它们的能量有上界：存在 $M>0$ 使得
$$\mathcal{i_n}\leq B<\infty,\quad \forall n\geq 0.$$
则极限
$$\lim_{n\to\infty}i_n = i$$
存在，并且 $i$ 是从 $a$ 点到 $\infty$ 的单位电流。
:::
**证明**：考虑从 $a$ 出发的随机游动，记 $Y_n(x)$ 是随机游动在到达 $Z_n$ 之前访问 $x$ 的次数。则 $\{Y_n(x)\}$ 是单调上升的序列，于是 $\mathbb{E}Y_n\uparrow \mathbb{E}Y_\infty$，其中 $Y_\infty$ 是随机游动在返回 $a$ 之前