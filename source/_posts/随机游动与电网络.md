---
title: "随机游动与电网络"
date: 2019-10-06
categories: [随机游动]
url: "random-walk-and-electric-network"
---

\newcommand{\ind}[1]{\mathbb{1}_{\{ #1 \}}}
\newcommand{\xarr}[1]{\xrightarrow{\quad #1 \quad}}

# 图上的线性代数

一个**网络** $\mathcal{N}=(G, c)$ 由一个有限图 $G=(V,E)$ 和一个权值函数 $c:E\to\mathbb{R}_{\geq0}$ 组成。这里 $G$ 是连通的无向图，其每条边 $e\in E$ 有一个权值 $c(e)\in[0, +\infty)$，叫做 $e$ 的**电导**，其倒数 $r(e)=1/c(e)$ 叫做 $e$ 的**电阻**。

设 $x,y\in V$ 是两个顶点，我们用 $x\sim y$ 表示 $x,y$ 是相邻的。当 $e=(x,y)$ 时，我们称 $e^-=x$ 为 $e$ 的**尾部**，$e^+=y$ 为 $e$ 的**头部**。记 $-e=(y,x)$ 为 $e$ 的**反向边**。在反向边 $-e$ 中 $x$ 变为头部，$y$ 变为尾部。

**我们约定 $E$ 总是同时包含一条边 $e=(x,y)$ 和它的反向边 $-e=(y,x)$**。此外，我们用记号 $E_{1/2}$ 表示对每个 $e$，在 $e$ 和 $-e$ 中任选一个组成的集合。$E_{1/2}$ 的一个选取方式对应 $G$ 的一个定向，不过我们不需要明确写出这个选取方式。

对 $e=(x,y)\in E$，我们也记 $c(x,y)=c(e)$。**我们要求电导函数 $c(x,y)$ 关于 $x,y$ 是对称的：$c(x,y)=c(y,x)$**。即在书写 $c(e)$ 的时候我们不用关心 $e$ 的定向。设 $x\in V$ 是一个顶点，记 $c(x)=\sum_{y\sim x}c(x,y)$ 是与 $x$ 相邻的所有边的电导之和。

所有 $V$ 上的实值函数 $f:V\to\mathbb{R}$ 构成一个内积空间 $\ell^2(V)$：
$$(f,\, g)_V = \sum_{x\in V}c(x)f(x)g(x).$$

所有 $E$ 上的**反对称**实值函数 $\theta: E\to\mathbb{R}$ 也构成一个内积空间 $\ell^2_{-}(E)$：
$$(\theta,\,\theta')_E = \frac{1}{2}\sum_{e\in E}r(e)\theta(e)\theta'(e)=\sum_{e\in E_{1/2}}r(e)\theta(e)\theta'(e).$$
这里 $\theta$ 是反对称函数的意思是，对任何 $e=\{x,y\}$ 有 $\theta(x, y)=-\theta(y,x)$。注意上式右边的求和与边的定向是无关的，因为如果把 $e$ 换成 $-e$ 的话，$\theta(e),\theta'(e)$ 同时变号，它们的乘积还是不变的。即内积 $(\cdot\,,\cdot)_E$ 的定义与 $E_{1/2}$ 的选取方式无关。

到目前为止，我们的设定基本上与 [@MR3616205] 一致，但是接下来的叙述会有一定的差别。

## 梯度和散度

:::{.definition}

1. 定义**梯度**算子 $\nabla: \ell^2(V)\to\ell^{2}_{-}(E)$ 为
   $$(\nabla f)(x,y) = c(x, y)\big[f(x)-f(y)\big]=c(e)\big[f(e^-)-f(e^+)\big].$$
   如果把 $f$ 理解为每个顶点处的电压的话，梯度算子给出的是电压之差除以电阻值，即经过边 $e$ 的有向电流。

2. 定义**散度**算子 $\mathrm{div}:\ell^{2}_{-}(E)\to\ell^2(V)$ 为
   $$(\mathrm{div}\,\theta)(x) = \frac{1}{c(x)}\sum_{y\sim x}\theta(x, y)=\frac{1}{c(x)}\sum_{e^-=x}\theta(e).$$
   上式右边可能有的求和项大于 0，有的小于 0。如果把 $\theta$ 理解为每条边上的有向电流的话，散度算子给出的是每个顶点处的净流出量。

3. 定义**拉普拉斯**算子 $\Delta:\ell^2(V)\to\ell^{2}(V)$ 为
   $$
   (\Delta f)(x) = (\mathrm{div}\,\nabla f)(x) = f(x)-\sum_{y\sim x}\frac{c(x,y)}{c(x)}f(y).
   $$
   如果 $(\Delta f)(x)=0$ 对 $x\in V$ 成立，我们就称 $f$ 在 $x$ 处是**调和**的。
:::

:::{.theorem #grad-div-conj}
梯度算子和散度算子是一对共轭算子：对任何 $f\in\ell^2(V)$ 和 $\theta\in\ell_{-}^2(E)$ 有
$$(f,\,\mathrm{div}\,\theta)_V = (\nabla f,\,\theta)_E.$$
:::

**证明**：上式两边关于 $f$ 是线性的，所以只要对 $\ell^2(V)$ 的一组基，即形如 $\ind{x}\,(x\in V)$ 的元素验证即可。这时左边是 $c(x)\cdot(\mathrm{div}\,\theta)(x)$，右边是 $\sum_{y\sim x}\theta(x,y)$，根据散度算子的定义，二者相等。$\blacksquare$

:::{.definition}
我们称映射 $\mathrm{div}$ 的核 $\mathrm{Ker\,div}$ 为环空间 (cycle space)，记作 $\lozenge$。称映射 $\nabla$ 的像 $\mathrm{Im}\nabla$ 为星空间 (star space)，记作 $\bigstar$。环空间和星空间都是 $\ell_{-}^2(E)$ 的子空间。
:::

:::{.theorem #cycle-star-direct-sum}
$\ell_{-}^2(E)=\lozenge\oplus\bigstar$。
:::

**证明**：由于 $\{\ind{x}\mid x\in V\}$ 构成 $\ell^2(V)$ 的一组基，所以它们在 $\nabla$ 下的像构成 $\bigstar$ 的一组基。根据 @Pre:grad-div-conj，对任何 $\theta\in\ell^2_{-}(E)$ 有
$$(\nabla \ind{x},\,\theta)_E=c(x)(\mathrm{div}\,\theta)(x).$$
于是 $\theta$ 与任何 $\nabla \ind{x}$ 正交当且仅当 $(\mathrm{div}\,\theta)(x)=0$ 对任何 $x\in V$ 成立，即当且仅当 $\theta\in\lozenge$，从而 $\lozenge$ 和 $\bigstar$ 互为正交补空间。$\blacksquare$

## 环空间和星空间的解释

我们来解释一下为什么这两个子空间叫做“环空间”和“星空间”。

首先是环空间。对任一 $e\in E$，记
$$\chi^e=\ind{e} - \ind{-e}\in\ell^2_{-}(E)$$
为边 $e$ 的示性函数，即 $\chi^e$ 在 $e$ 和 $-e$ 上取值分别为 $\pm1$，在其它边上都是 0。显然 $\chi^{e}=-\chi^{-e}$。

设 $e_1=(v_1,v_2), e_2=(v_2,v_3),\ldots,e_k=(v_k,v_1)$ 首尾相接构成一条回路 $C$，即
$$v_1\xarr{e_1}v_2\xarr{e_2}\cdots\xarr{e_{k-1}}v_k\xarr{e_k}v_1.$$

![](/images/electric-network/cycle.svg){width=150 .fig}

定义环函数 $f^C = \sum_{i=1}^k\chi^{e_i}$，则从 $v_1$ 出发绕 $C$ 一圈一路上经过的所有边 $f$ 的值都是 $+1$ （沿着反方向绕都是 $-1$），于是 $f^C$ 在 $C$ 包含的每个顶点上 1 进 1 出，在 $C$ 之外的顶点上 0 进 0 出，从而 $f^C\in\lozenge$。

我们断言 $\lozenge$ 可以由所有的环函数 $f^C$ 张成，这就是为什么 $\lozenge$ 叫做环空间。

设 $\theta\in\lozenge$，定义 $\theta$ 的支集为
$$\mathrm{supp}(\theta)=\{e\in E\mid\theta(e)\ne0\}.$$
如果 $\mathrm{supp}(\theta)$ 非空，则它必然包含一个回路，若不然，$\mathrm{supp}(\theta)$ 是一个森林，从而必然包含某个叶顶点（度数恰好为 1），这一点处的散度不可能为 0，矛盾！于是 $\mathrm{supp}(\theta)$ 包含一个回路 $C$，我们可以选择合适的常数 $\alpha$ 使得 $\widetilde{\theta}=\theta-\alpha f^C$ 在某个 $e\in C$ 上为 0，则 $\widetilde{\theta}$ 的支集严格小于 $\theta$。对 $\widetilde{\theta}$ 重复此操作一直下去必然可以在有限次后将支集变为空集，这就证明了 $\theta$ 可以表示为形如 $f^C$ 的线性组合。

星空间也有一个类似的形象描述。对每个顶点 $x$，我们也有一个 $\ell^2_{-}(E)$ 上的函数与之对应：$\sum_{e^-=x}c(e)\chi^e$。这个函数很直观，它的支集是从 $x$ 出发伸出去的星状结构。

![](/images/electric-network/div.svg){width=150 .fig}

对任何 $\theta\in\ell^2_{-}(E)$，我们有
$$(\mathrm{div}\,\theta)(x)=\sum_{e^-=x}\theta(e)=\sum_{e^-=x}\left(c(e)\chi^e,\theta\right)_E=\left(\sum_{e^-=x}c(e)\chi^e,\theta\right)_E.$$
由于 $\theta\in\lozenge$ 当且仅当 $(\mathrm{div}\,\theta)(x)=0$ 对所有 $\in V$ 成立，也就是 $\theta$ 与所有 $\sum_{e^-=x}c(e)\chi^e$ 正交，所以我们证明了 $\left\{\sum_{e^-=x}c(e)\chi^e\mid x\in V\right\}$ 可以生成 $\bigstar$。

# 网络中的流

设 $Z\subset V$ 是顶点集的一个子集，$a\notin Z$ 是一个顶点。

:::{.definition}
我们称 $\theta\in\ell_{-}^2(E)$ 是一个从 $a$ 到 $Z$ 的流，如果以下两个条件成立：

1. $(\mathrm{div}\,\theta)(a)\geq 0$。
2. 对任何 $x\notin \{a\}\cup Z$ 有 $(\mathrm{div}\,\theta)(x)=0$。

$a$ 叫做 $\theta$ 的**源点**，$Z$ 叫做 $\theta$ 的**汇点**。

定义流 $\theta$ 的**强度**为从源点 $a$ 流入网络的量：
$$\mathrm{strength}(\theta)=\sum_{x\sim a}\theta(a, x).$$
我们也把 $\mathrm{strength}(\theta)$ 记作 $\|\theta\|$，如果有 $\|\theta\|=1$ 成立，就称 $\theta$ 是一个**单位流**。

此外定义 $\theta$ 的**能量**为
$$\mathcal{E}(\theta)=(\theta,\,\theta)_E.$$
:::

这个定义蕴含了 $\sum_{z\in Z}(\mathrm{div}\,\theta)(z)=-(\mathrm{div}\,\theta)(a)$：考虑 $V$ 上的常函数 $1$，则 $\nabla 1=0$，于是 $$0=(\nabla 1,\,\theta)_E=(1,\,\mathrm{div}\,\theta)_V=(\mathrm{div}\,\theta)(a)+\sum_{z\in Z}(\mathrm{div}\,\theta)(z).$$ 即对整个网络来说，从 $a$ 流出的量等于流入 $Z$ 的量，中间没有任何“淤积”。

:::{.definition}
设 $\theta$ 是一个从 $a$ 到 $Z$ 的流，如果还有 $\theta=\nabla g\in\bigstar$ 成立，就称 $\theta$ 是一个**电流**，$g$ 叫做 $\theta$ 的电势。
:::

我们总结一下流和电流的特点：

1. 你可以把 $a$ 理解为电源正极，$Z$ 理解为网络接地的部分。
2. 流函数要求对任何 $x\notin \{a\}\cup Z$ 有 $(\mathrm{div}\,\theta)(x)=0$ 等价于物理中的基尔霍夫电流定律：任何中间节点的流量守恒。
3. 电流函数要求 $\theta=\nabla g\in\bigstar$ 等价于物理中的欧姆定律，即电流 $\theta$ 等于电势差除以电阻 $r(e)$。

# 电网络

本节我们将利用概率量给出网络的电势、电流、电阻的定义，这些定义都是纯数学的，但它们与物理含义都是一致的。

记 $\{X_t,t\geq0\}$ 是从顶点 $x$ 出发，转移概率为 $P(x,y)=c(x,y)/c(x)$ 的随机游动，其中 $X_0=x$。$\{X_t\}$ 是可逆 Markov 链，以 $\{c(x),x\in V\}$ 为平稳测度：
$$c(x)P(x,y)=c(y)P(y,x).$$

设 $a$ 是一个顶点，$Z\subset V$ 是顶点集的子集，且 $a\notin Z$。记 $\tau_a,\tau_Z\in\mathbb{Z}_{\geq0}\cup\{\infty\}$ 分别是随机游动首次到达 $a$ 和 $Z$ 的时间。令 $\tau^+=\max(\tau,1)$，则 $\tau_a^+,\tau_Z^+$ 分别表示随机游动严格地在未来某个时刻首次到达 $a$ 和 $Z$ 的时间（不计初始时刻）。

考察概率
$$h(x) = \mathbb{P}_x(\tau_a<\tau_Z).$$
则 $h(x)$ 满足边界条件 $h(a)=1, h(Z)=0$，并且利用单步转移概率不难看出 $h(x)$ 在任何 $x\notin \{a\}\cup Z$ 上是**调和**的：
$$h(x)=\sum_{y\sim x}P(x, y)h(y).$$

另一方面，在 $a$ 点加上 1 单位的电压，则其电势 $v(a)=1$，由于 $Z$ 接地所以 $v(Z)=0$。我们断言电势函数 $v(x)$ 在任何一点 $x\notin\{a\}\cup Z$ 处也是调和的：
$$v(x) = \sum_{y\sim x}P(x, y)v(y).$$
这是因为设 $v$ 对应的电流是 $i$，则

$$
\begin{aligned}
v(x) - \sum_{y\sim x}P(x, y)v(y)&=
\sum_{y\sim x}P(x, y)(v(x)-v(y))\\&=
\sum_{y\sim x}\frac{c(x,y)}{c(x)}i(x,y)r(x,y)\\&=
\frac{1}{c(x)}\sum_{y\sim x}i(x,y)\\&=
0.
\end{aligned}
$$

现在，$h(x)$ 和 $v(x)$ 在 $\{a\}\cup Z$ 上有相同的边界条件，在 $(\{a\}\cup Z)^c$ 上都是调和的，利用调和函数的极大值原理，我们不难得出它俩必然是同一个函数！

:::{.simple}
**电压的概率解释**：在 $a$ 加上单位 1 的电压，将 $Z$ 接地，则任一顶点 $x$ 处的电势等于从 $x$ 出发的随机游动在到达 $Z$ 之前先到达 $a$ 的概率：$v(x)=\mathbb{P}_x(\tau_a<\tau_Z)$。
:::

为了继续给出电流的概率解释，我们需要介绍 Green 函数的概念。Green 函数是图上拉普拉斯算子的“基本解”，用它可以表示出一般的带边界条件的调和函数。

记 $\mathbb{P}(a\to Z)=\mathbb{P}_a(\tau_Z < \tau_a^+)$ 为从 $a$ 出发的随机游动在返回 $a$ 之前先到达 $Z$ 的概率。此概率称作从 $a$ 到 $Z$ 的**逃逸概率**。其中 $\tau_a^+\in\{1,2,\ldots,\infty\}$ 是从 $a$ 出发的随机游动，不计初始时刻的那一次，在未来首次回到 $a$ 的时刻。

:::{.lemma #v-div-i}
$$\frac{v(a)}{\| i\|} = \frac{1}{c(a)\mathbb{P}(a\to Z)}.$$
:::

注意 $v(a)/\|i\|$ 正是网络的等效电阻。

**证明**：

$$
\begin{aligned}
\mathbb{P}(a\to Z) &= \sum_{x\sim a}P(a, x)\mathbb{P}_x(\tau_Z < \tau_a)\\&=
\sum_{x\sim a}\frac{c(a,x)}{c(a)}\left(1-\frac{v(x)}{v(a)}\right)\\&=
\sum_{x\sim a}\frac{c(a,x)}{c(a)}\frac{v(a)-v(x)}{v(a)}\\&=
\sum_{x\sim a}\frac{i(a,x)}{c(a)v(a)}\\&=
\frac{\|i\|}{c(a)v(a)}.
\end{aligned}
$$

$\blacksquare$

对任何边 $x\sim y$，定义随机变量 $N_{x\to y}^Z$ 为从 $a$ 出发的随机游动在访问 $Z$ 之前从 $x$ 走到 $y$ 的次数，则我们有如下定理：

:::{.theorem #current-interp}
设电流是单位电流：$\|i\|=1$，此时的电势函数为 $v$，则

1. $v(x) = \mathcal{G}_Z(a, x)/ c(x)$。
2. $i(x,y)=\mathbb{E}_a\left[N_{x\to y}^Z - N_{y\to x}^Z\right]$。

其中 $\mathcal{G}_Z(a, x)$ 是随机游动的 Green 函数，其定义为从 $a$ 出发的随机游动在到达 $Z$ 之前访问 $x$ 的期望次数： $$\mathcal{G}_Z(a, x) = \sum_{0\leq k<\tau_Z}\mathbb{1}_{\{X_k=x\}}.$$
:::

**证明**：

1. 首先边界条件给出了 $\mathcal{G}_Z(a, Z)=0$。此外 $\mathcal{G}_Z(a, a)$ 是一个每次试验成功概率为 $\mathbb{P}(a\to Z)$ 的几何分布的随机变量的期望，故 $$\mathcal{G}_Z(a, a)=\frac{1}{\mathbb{P}(a\to Z)},$$ 再由 @Pre:v-div-i 有
$$\frac{\mathcal{G}_Z(a, a)}{c(a)}=\frac{1}{c(a)\mathbb{P}(a\to Z)}=v(a).$$
所以 $\mathcal{G}_Z(a, x)/c(x)$ 在边界上与电势函数是一致的，只要再证明在任意中间节点 $x$ 的调和性质。注意随机游动必然是从与 $x$ 相邻的顶点走过去访问 $x$，所以 $$\frac{\mathcal{G}_Z(a, x)}{c(x)}=\frac{1}{c(x)}\sum_{y\sim x}\mathbb{E}_a[N_{y\to x}^Z].$$

   另一方面
   $$
   \begin{aligned}
   \mathbb{E}_a[N_{y\to x}^Z]&=
   \mathbb{E}_a\left[\sum_{0\leq t<\tau_Z}\ind{X_t=y,X_{t+1}=x}\right]\\&=
   \sum_{0\leq t<\tau_Z}\mathbb{P}\left[X_t=y,X_{t+1}=x\right]\\&=
   \sum_{0\leq t<\tau_Z}\mathbb{P}(X_t=y)P(y,x)\\&=
   P(y,x)\mathbb{E}_a\left[\sum_{0\leq t<\tau_Z}\ind{X_t=y}\right]\\&=
   P(y,x)\mathcal{G}_Z(a,y).
   \end{aligned}
   \label{eq:cross}
   $$

   所以代入求和后有

   $$
   \frac{1}{c(x)}\sum_{y\sim x}\mathbb{E}_a[N_{y\to x}^Z]=\frac{1}{c(x)}\sum_{y\sim x}P(y,x)\mathcal{G}_Z(a,y)=\sum_{y\sim x}P(x,y)\frac{\mathcal{G}_Z(a,y)}{c(y)}.
   $$

   其中我们使用了 Markov 链的可逆性：$c(x)P(x,y)=c(y)P(y,x)$。这就证明了 $\mathcal{G}_Z(a, x)/c(x)$ 在中间节点的调和性，从而它就是电势函数，这证明了 1。

2. 直接验证即可：
   $$\begin{align*}\mathbb{E}_a\left[N_{x\to y}^Z - N_{y\to x}^Z\right]&=P(x,y)\mathcal{G}_Z(a,x)-P(y,x)\mathcal{G}_Z(a,y)\\&=P(x,y)c(x)v(x) - P(y,x)c(y)v(y)\\&=c(x,y)(v(x)-v(y))\\&=i(x,y).\end{align*}$$

$\blacksquare$


[^1]: Lyons, Russell, and Peres, Yuval. 2016. Probability on Trees and Networks. Cambridge Series in Statistical and Probabilistic Mathematics, vol. 42.
[^2]: Richard Stanley. 2013. Algebraic Combinatorics: Walks, Trees, Tableaux, and More. Undergraduate Texts in Mathematics. Springer-Verlag New York.
